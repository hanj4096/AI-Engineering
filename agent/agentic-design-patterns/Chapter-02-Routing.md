<mark>ç¬¬äºŒç« ï¼šè·¯ç”±ï¼ˆRoutingï¼‰</mark>

è·¯ç”±æ¨¡å¼æ¦‚è¿°
------

è™½ç„¶é€šè¿‡æç¤ºé“¾å®ç°çš„é¡ºåºå¤„ç†æ˜¯åˆ©ç”¨è¯­è¨€æ¨¡å‹æ‰§è¡Œç¡®å®šæ€§ã€çº¿æ€§å·¥ä½œæµçš„åŸºç¡€æŠ€æœ¯ï¼Œä½†åœ¨éœ€è¦è‡ªé€‚åº”å“åº”çš„åœºæ™¯ä¸‹ï¼Œå…¶é€‚ç”¨æ€§æœ‰é™ã€‚ç°å®ä¸­çš„æ™ºèƒ½ä½“ç³»ç»Ÿé€šå¸¸éœ€è¦æ ¹æ®ç¯å¢ƒçŠ¶æ€ã€ç”¨æˆ·è¾“å…¥æˆ–å‰åºæ“ä½œç»“æœç­‰å› ç´ ï¼Œåœ¨å¤šä¸ªæ½œåœ¨åŠ¨ä½œä¹‹é—´è¿›è¡Œä»²è£ã€‚è¿™ç§åŠ¨æ€å†³ç­–èƒ½åŠ›â€”â€”å³æ ¹æ®ç‰¹å®šæ¡ä»¶å°†æ§åˆ¶æµå¯¼å‘ä¸åŒçš„ä¸“ç”¨å‡½æ•°ã€å·¥å…·æˆ–å­æµç¨‹â€”â€”å°±æ˜¯é€šè¿‡â€œè·¯ç”±â€æœºåˆ¶å®ç°çš„ã€‚

è·¯ç”±ä¸ºæ™ºèƒ½ä½“çš„æ“ä½œæ¡†æ¶å¼•å…¥äº†æ¡ä»¶é€»è¾‘ï¼Œä½¿å…¶ä»å›ºå®šæ‰§è¡Œè·¯å¾„è½¬å˜ä¸ºåŠ¨æ€è¯„ä¼°ç‰¹å®šæ ‡å‡†ã€ä»ä¸€ç»„å¯èƒ½çš„åç»­åŠ¨ä½œä¸­è¿›è¡Œé€‰æ‹©çš„æ¨¡å¼ï¼Œä»è€Œå®ç°æ›´çµæ´»ã€å…·å¤‡ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç³»ç»Ÿè¡Œä¸ºã€‚

ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨äºå®¢æˆ·å’¨è¯¢çš„æ™ºèƒ½ä½“åœ¨å…·å¤‡è·¯ç”±åŠŸèƒ½åï¼Œå¯ä»¥é¦–å…ˆå¯¹ç”¨æˆ·æŸ¥è¯¢è¿›è¡Œåˆ†ç±»ä»¥åˆ¤æ–­æ„å›¾ã€‚æ ¹æ®åˆ†ç±»ç»“æœï¼ŒæŸ¥è¯¢å¯ä»¥è¢«å¯¼å‘ä¸“é—¨çš„é—®ç­”æ™ºèƒ½ä½“ã€ç”¨äºè´¦æˆ·ä¿¡æ¯æ£€ç´¢çš„æ•°æ®åº“å·¥å…·ï¼Œæˆ–ç”¨äºå¤æ‚é—®é¢˜å‡çº§çš„æµç¨‹ï¼Œè€Œä¸æ˜¯å§‹ç»ˆé‡‡ç”¨å•ä¸€ã€é¢„è®¾çš„å“åº”è·¯å¾„ã€‚å› æ­¤ï¼Œä¸€ä¸ªæ›´é«˜çº§çš„è·¯ç”±æ™ºèƒ½ä½“å¯ä»¥ï¼š

1.   åˆ†æç”¨æˆ·æŸ¥è¯¢ã€‚
2.   **æ ¹æ®æŸ¥è¯¢æ„å›¾è¿›è¡Œè·¯ç”±**ï¼š
    *   å¦‚æœæ„å›¾ä¸ºâ€œæŸ¥è¯¢è®¢å•çŠ¶æ€â€ï¼Œåˆ™è·¯ç”±åˆ°ä¸è®¢å•æ•°æ®åº“äº¤äº’çš„å­æ™ºèƒ½ä½“æˆ–å·¥å…·é“¾ã€‚
    *   å¦‚æœæ„å›¾ä¸ºâ€œäº§å“ä¿¡æ¯â€ï¼Œåˆ™è·¯ç”±åˆ°æ£€ç´¢äº§å“ç›®å½•çš„å­æ™ºèƒ½ä½“æˆ–é“¾ã€‚
    *   å¦‚æœæ„å›¾ä¸ºâ€œæŠ€æœ¯æ”¯æŒâ€ï¼Œåˆ™è·¯ç”±åˆ°è®¿é—®æ•…éšœæ’æŸ¥æŒ‡å—æˆ–å‡çº§åˆ°äººå·¥çš„é“¾ã€‚
    *   å¦‚æœæ„å›¾ä¸æ˜ç¡®ï¼Œåˆ™è·¯ç”±åˆ°æ¾„æ¸…æ„å›¾çš„å­æ™ºèƒ½ä½“æˆ–æç¤ºé“¾ã€‚

è·¯ç”±æ¨¡å¼çš„æ ¸å¿ƒç»„ä»¶æ˜¯æ‰§è¡Œè¯„ä¼°å¹¶å¼•å¯¼æµç¨‹çš„æœºåˆ¶ï¼Œå…¶å®ç°æ–¹å¼åŒ…æ‹¬ï¼š

*   **åŸºäº LLM çš„è·¯ç”±**ï¼šé€šè¿‡æç¤ºè¯­è¨€æ¨¡å‹åˆ†æè¾“å…¥ï¼Œå¹¶è¾“å‡ºæŒ‡ç¤ºä¸‹ä¸€æ­¥æˆ–ç›®æ ‡çš„æ ‡è¯†ç¬¦æˆ–æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æç¤º LLMï¼šâ€œåˆ†æä»¥ä¸‹ç”¨æˆ·æŸ¥è¯¢ï¼Œä»…è¾“å‡ºç±»åˆ«ï¼šâ€˜è®¢å•çŠ¶æ€â€™ã€â€˜äº§å“ä¿¡æ¯â€™ã€â€˜æŠ€æœ¯æ”¯æŒâ€™æˆ–â€˜å…¶ä»–â€™â€ã€‚æ™ºèƒ½ä½“ç³»ç»Ÿè¯»å–è¾“å‡ºå¹¶æ®æ­¤å¼•å¯¼å·¥ä½œæµã€‚
*   **åŸºäºåµŒå…¥çš„è·¯ç”±**ï¼šå°†è¾“å…¥æŸ¥è¯¢è½¬ä¸ºå‘é‡åµŒå…¥ï¼ˆå‚è§ [ç¬¬ 14 ç«  RAG]ï¼‰ï¼Œå†ä¸ä»£è¡¨ä¸åŒè·¯ç”±æˆ–èƒ½åŠ›çš„åµŒå…¥è¿›è¡Œæ¯”å¯¹ï¼Œå°†æŸ¥è¯¢è·¯ç”±åˆ°æœ€ç›¸ä¼¼çš„è·¯å¾„ã€‚é€‚ç”¨äºè¯­ä¹‰è·¯ç”±ï¼Œå³å†³ç­–åŸºäºè¾“å…¥çš„å«ä¹‰è€Œéå…³é”®è¯ã€‚
*   **åŸºäºè§„åˆ™çš„è·¯ç”±**ï¼šä½¿ç”¨é¢„å®šä¹‰è§„åˆ™æˆ–é€»è¾‘ï¼ˆå¦‚ if-elseã€switch caseï¼‰ï¼Œæ ¹æ®å…³é”®è¯ã€æ¨¡å¼æˆ–ç»“æ„åŒ–æ•°æ®è¿›è¡Œè·¯ç”±ã€‚æ­¤æ–¹æ³•æ¯” LLM è·¯ç”±æ›´å¿«ã€æ›´ç¡®å®šï¼Œä½†å¤„ç†å¤æ‚æˆ–æ–°é¢–è¾“å…¥çš„çµæ´»æ€§è¾ƒä½ã€‚
*   **åŸºäºæœºå™¨å­¦ä¹ æ¨¡å‹çš„è·¯ç”±**ï¼šé‡‡ç”¨å¦‚åˆ†ç±»å™¨ç­‰åˆ¤åˆ«æ¨¡å‹ï¼Œåœ¨å°è§„æ¨¡æ ‡æ³¨æ•°æ®é›†ä¸Šä¸“é—¨è®­ç»ƒä»¥å®ç°è·¯ç”±ä»»åŠ¡ã€‚ä¸åµŒå…¥æ–¹æ³•ç±»ä¼¼ï¼Œä½†å…¶ç‰¹ç‚¹æ˜¯ç›‘ç£å¾®è°ƒè¿‡ç¨‹ï¼Œè·¯ç”±é€»è¾‘ç¼–ç åœ¨æ¨¡å‹æƒé‡ä¸­ã€‚ä¸ LLM è·¯ç”±ä¸åŒï¼Œå†³ç­–ç»„ä»¶ä¸æ˜¯æ¨ç†æ—¶æ‰§è¡Œæç¤ºçš„ç”Ÿæˆæ¨¡å‹ï¼Œè€Œæ˜¯å·²å¾®è°ƒçš„åˆ¤åˆ«æ¨¡å‹ã€‚LLM å¯ç”¨äºç”Ÿæˆåˆæˆè®­ç»ƒæ•°æ®ï¼Œä½†ä¸å‚ä¸å®æ—¶è·¯ç”±å†³ç­–ã€‚

è·¯ç”±æœºåˆ¶å¯åœ¨æ™ºèƒ½ä½“æ“ä½œå‘¨æœŸçš„å¤šä¸ªé˜¶æ®µå®ç°ï¼šæ—¢å¯ç”¨äºåˆå§‹ä»»åŠ¡åˆ†ç±»ï¼Œä¹Ÿå¯åœ¨å¤„ç†é“¾ä¸­é—´å†³å®šåç»­åŠ¨ä½œï¼Œæˆ–åœ¨å­æµç¨‹ä¸­é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ã€‚

[LangChain](https://github.com/langchain-ai/langchain)ã€ [LangGraph](https://github.com/langchain-ai/langgraph)å’Œ Google çš„ [Agent Developer Kit (ADK)](https://google.github.io/adk-docs/)ç­‰è®¡ç®—æ¡†æ¶æä¾›äº†å®šä¹‰å’Œç®¡ç†æ­¤ç±»æ¡ä»¶é€»è¾‘çš„æ˜¾å¼ç»“æ„ã€‚LangGraph ä»¥å…¶åŸºäºçŠ¶æ€çš„å›¾æ¶æ„ï¼Œå°¤å…¶é€‚åˆéœ€è¦æ ¹æ®ç³»ç»Ÿç´¯ç§¯çŠ¶æ€è¿›è¡Œå†³ç­–çš„å¤æ‚è·¯ç”±åœºæ™¯ã€‚Google ADK åˆ™ä¸ºæ™ºèƒ½ä½“èƒ½åŠ›å’Œäº¤äº’æ¨¡å‹çš„ç»“æ„åŒ–æä¾›åŸºç¡€ç»„ä»¶ï¼Œä¾¿äºå®ç°è·¯ç”±é€»è¾‘ã€‚åœ¨è¿™äº›æ¡†æ¶çš„æ‰§è¡Œç¯å¢ƒä¸­ï¼Œå¼€å‘è€…å®šä¹‰å¯èƒ½çš„æ“ä½œè·¯å¾„ï¼Œä»¥åŠå†³å®šèŠ‚ç‚¹é—´è½¬æ¢çš„å‡½æ•°æˆ–æ¨¡å‹è¯„ä¼°ã€‚

è·¯ç”±çš„å®ç°ä½¿ç³»ç»Ÿè¶…è¶Šäº†ç¡®å®šæ€§é¡ºåºå¤„ç†ï¼Œèƒ½å¤Ÿå¼€å‘å‡ºæ›´å…·é€‚åº”æ€§çš„æ‰§è¡Œæµï¼ŒåŠ¨æ€å“åº”æ›´å¹¿æ³›çš„è¾“å…¥å’ŒçŠ¶æ€å˜åŒ–ã€‚

å®è·µåº”ç”¨ä¸åœºæ™¯
-------

è·¯ç”±æ¨¡å¼æ˜¯è®¾è®¡è‡ªé€‚åº”æ™ºèƒ½ä½“ç³»ç»Ÿçš„å…³é”®æ§åˆ¶æœºåˆ¶ï¼Œä½¿å…¶èƒ½å¤Ÿæ ¹æ®è¾“å…¥å’Œå†…éƒ¨çŠ¶æ€åŠ¨æ€è°ƒæ•´æ‰§è¡Œè·¯å¾„ï¼Œå¹¿æ³›åº”ç”¨äºå¤šä¸ªé¢†åŸŸã€‚

åœ¨äººæœºäº¤äº’åœºæ™¯ï¼ˆå¦‚è™šæ‹ŸåŠ©æ‰‹ã€AI æ•™å¸ˆï¼‰ä¸­ï¼Œè·¯ç”±ç”¨äºè§£æç”¨æˆ·æ„å›¾ã€‚ç³»ç»Ÿå¯¹è‡ªç„¶è¯­è¨€æŸ¥è¯¢è¿›è¡Œåˆæ­¥åˆ†æï¼Œå†³å®šåç»­åŠ¨ä½œï¼Œå¦‚è°ƒç”¨ä¿¡æ¯æ£€ç´¢å·¥å…·ã€å‡çº§åˆ°äººå·¥ã€æˆ–æ ¹æ®ç”¨æˆ·è¡¨ç°é€‰æ‹©ä¸‹ä¸€ä¸ªè¯¾ç¨‹æ¨¡å—ï¼Œä»è€Œå®ç°è¶…è¶Šçº¿æ€§å¯¹è¯æµçš„ä¸Šä¸‹æ–‡å“åº”ã€‚

åœ¨è‡ªåŠ¨åŒ–æ•°æ®ä¸æ–‡æ¡£å¤„ç†æµç¨‹ä¸­ï¼Œè·¯ç”±æ‰¿æ‹…åˆ†ç±»ä¸åˆ†å‘åŠŸèƒ½ã€‚ç³»ç»Ÿæ ¹æ®å†…å®¹ã€å…ƒæ•°æ®æˆ–æ ¼å¼åˆ†æå¦‚é‚®ä»¶ã€å·¥å•ã€API æ•°æ®ï¼Œå¹¶å°†å…¶å¯¼å‘ç›¸åº”å·¥ä½œæµï¼Œå¦‚é”€å”®çº¿ç´¢å¯¼å…¥ã€é’ˆå¯¹ JSON/CSV çš„æ•°æ®è½¬æ¢ã€æˆ–ç´§æ€¥é—®é¢˜å‡çº§ã€‚

åœ¨æ¶‰åŠå¤šä¸ªä¸“ç”¨å·¥å…·æˆ–æ™ºèƒ½ä½“çš„å¤æ‚ç³»ç»Ÿä¸­ï¼Œè·¯ç”±å……å½“é«˜çº§è°ƒåº¦å™¨ã€‚ä¾‹å¦‚ï¼Œç ”ç©¶ç³»ç»Ÿç”±æ£€ç´¢ã€æ‘˜è¦ã€åˆ†æç­‰æ™ºèƒ½ä½“ç»„æˆï¼Œè·¯ç”±å™¨æ ¹æ®å½“å‰ç›®æ ‡åˆ†é…ä»»åŠ¡ã€‚åŒæ ·ï¼ŒAI ç¼–ç¨‹åŠ©æ‰‹ä¼šå…ˆè¯†åˆ«ç¼–ç¨‹è¯­è¨€å’Œç”¨æˆ·æ„å›¾ï¼ˆè°ƒè¯•ã€è§£é‡Šã€ç¿»è¯‘ï¼‰ï¼Œå†å°†ä»£ç ç‰‡æ®µäº¤ç»™å¯¹åº”å·¥å…·å¤„ç†ã€‚

æ€»ä¹‹ï¼Œè·¯ç”±ä¸ºç³»ç»Ÿæä¾›äº†é€»è¾‘ä»²è£èƒ½åŠ›ï¼Œæ˜¯æ„å»ºåŠŸèƒ½å¤šæ ·ã€å…·å¤‡ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç³»ç»Ÿçš„åŸºç¡€ã€‚å®ƒå°†æ™ºèƒ½ä½“ä»é™æ€æ‰§è¡Œè€…è½¬å˜ä¸ºèƒ½æ ¹æ®å˜åŒ–æ¡ä»¶åšå‡ºå†³ç­–çš„åŠ¨æ€ç³»ç»Ÿã€‚

å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆLangChainï¼‰
-----------------

ä»£ç å®ç°è·¯ç”±éœ€å®šä¹‰å¯èƒ½è·¯å¾„åŠå†³ç­–é€»è¾‘ã€‚LangChain å’Œ LangGraph ç­‰æ¡†æ¶æä¾›äº†ä¸“ç”¨ç»„ä»¶å’Œç»“æ„ï¼ŒLangGraph çš„çŠ¶æ€å›¾ç»“æ„å°¤å…¶é€‚åˆè·¯ç”±é€»è¾‘çš„å¯è§†åŒ–å’Œå®ç°ã€‚

ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº†ä½¿ç”¨ LangChain å’Œ Google ç”Ÿæˆå¼ AI æ„å»ºçš„ç®€å•æ™ºèƒ½ä½“ç³»ç»Ÿã€‚ç³»ç»Ÿè®¾ç½®ä¸€ä¸ªâ€œåè°ƒè€…â€ï¼Œæ ¹æ®è¯·æ±‚æ„å›¾ï¼ˆé¢„è®¢ã€ä¿¡æ¯ã€æˆ–ä¸æ˜ç¡®ï¼‰å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„â€œå­æ™ºèƒ½ä½“â€å¤„ç†å™¨ã€‚ç³»ç»Ÿåˆ©ç”¨è¯­è¨€æ¨¡å‹åˆ†ç±»è¯·æ±‚ï¼Œå¹¶å§”æ‰˜ç»™ç›¸åº”å¤„ç†å‡½æ•°ï¼Œæ¨¡æ‹Ÿå¤šæ™ºèƒ½ä½“æ¶æ„ä¸­çš„åŸºæœ¬å§”æ‰˜æ¨¡å¼ã€‚

é¦–å…ˆï¼Œç¡®ä¿å®‰è£…æ‰€éœ€åº“ï¼š

```
pip install langchain langgraph google-cloud-aiplatform langchain-google-genai google-adk deprecated pydantic
```

è¿˜éœ€é…ç½®è¯­è¨€æ¨¡å‹ API å¯†é’¥ï¼ˆå¦‚ OpenAIã€Google Geminiã€Anthropicï¼‰ã€‚

ğŸ“„ è·¯ç”±ç¤ºä¾‹ä»£ç 

```Python
# Copyright (c) 2025 Marco Fago
# https://www.linkedin.com/in/marco-fago/
#
# æœ¬ä»£ç é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ä»“åº“ LICENSE æ–‡ä»¶ã€‚

from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.output_parsers import StrOutputParser
from langchain_core.runnables import RunnablePassthrough, RunnableBranch

# --- é…ç½® ---
# ç¡®ä¿ç¯å¢ƒå˜é‡å·²è®¾ç½® API å¯†é’¥ï¼ˆå¦‚ GOOGLE_API_KEYï¼‰
try:
   llm = ChatGoogleGenerativeAI(model="gemini-2.5-flash", temperature=0)
   print(f"è¯­è¨€æ¨¡å‹åˆå§‹åŒ–æˆåŠŸï¼š{llm.model}")
except Exception as e:
   print(f"è¯­è¨€æ¨¡å‹åˆå§‹åŒ–å¤±è´¥ï¼š{e}")
   llm = None

# --- å®šä¹‰æ¨¡æ‹Ÿå­æ™ºèƒ½ä½“å¤„ç†å™¨ï¼ˆç­‰åŒäº ADK sub_agentsï¼‰ ---

def booking_handler(request: str) -> str:
   """æ¨¡æ‹Ÿé¢„è®¢æ™ºèƒ½ä½“å¤„ç†è¯·æ±‚ã€‚"""
   print("\n--- å§”æ‰˜ç»™é¢„è®¢å¤„ç†å™¨ ---")
   return f"é¢„è®¢å¤„ç†å™¨å·²å¤„ç†è¯·æ±‚ï¼š'{request}'ã€‚ç»“æœï¼šæ¨¡æ‹Ÿé¢„è®¢åŠ¨ä½œã€‚"

def info_handler(request: str) -> str:
   """æ¨¡æ‹Ÿä¿¡æ¯æ™ºèƒ½ä½“å¤„ç†è¯·æ±‚ã€‚"""
   print("\n--- å§”æ‰˜ç»™ä¿¡æ¯å¤„ç†å™¨ ---")
   return f"ä¿¡æ¯å¤„ç†å™¨å·²å¤„ç†è¯·æ±‚ï¼š'{request}'ã€‚ç»“æœï¼šæ¨¡æ‹Ÿä¿¡æ¯æ£€ç´¢ã€‚"

def unclear_handler(request: str) -> str:
   """å¤„ç†æ— æ³•å§”æ‰˜çš„è¯·æ±‚ã€‚"""
   print("\n--- å¤„ç†ä¸æ˜ç¡®è¯·æ±‚ ---")
   return f"åè°ƒè€…æ— æ³•å§”æ‰˜è¯·æ±‚ï¼š'{request}'ã€‚è¯·è¡¥å……è¯´æ˜ã€‚"

# --- å®šä¹‰åè°ƒè€…è·¯ç”±é“¾ï¼ˆç­‰åŒäº ADK åè°ƒè€…æŒ‡ä»¤ï¼‰ ---
coordinator_router_prompt = ChatPromptTemplate.from_messages([
   ("system", """åˆ†æç”¨æˆ·è¯·æ±‚ï¼Œåˆ¤æ–­åº”ç”±å“ªä¸ªä¸“å±å¤„ç†å™¨å¤„ç†ã€‚
    - è‹¥è¯·æ±‚æ¶‰åŠé¢„è®¢æœºç¥¨æˆ–é…’åº—ï¼Œè¾“å‡º 'booker'ã€‚
    - å…¶ä»–ä¸€èˆ¬ä¿¡æ¯é—®é¢˜ï¼Œè¾“å‡º 'info'ã€‚
    - è‹¥è¯·æ±‚ä¸æ˜ç¡®æˆ–ä¸å±äºä¸Šè¿°ç±»åˆ«ï¼Œè¾“å‡º 'unclear'ã€‚
    åªè¾“å‡ºä¸€ä¸ªè¯ï¼š'booker'ã€'info' æˆ– 'unclear'ã€‚"""),
   ("user", "{request}")
])

if llm:
   coordinator_router_chain = coordinator_router_prompt | llm | StrOutputParser()

# --- å®šä¹‰å§”æ‰˜é€»è¾‘ï¼ˆç­‰åŒäº ADK çš„ Auto-Flowï¼‰ ---
branches = {
   "booker": RunnablePassthrough.assign(output=lambda x: booking_handler(x['request']['request'])),
   "info": RunnablePassthrough.assign(output=lambda x: info_handler(x['request']['request'])),
   "unclear": RunnablePassthrough.assign(output=lambda x: unclear_handler(x['request']['request'])),
}

delegation_branch = RunnableBranch(
   (lambda x: x['decision'].strip() == 'booker', branches["booker"]),
   (lambda x: x['decision'].strip() == 'info', branches["info"]),
   branches["unclear"] # é»˜è®¤åˆ†æ”¯
)

coordinator_agent = {
   "decision": coordinator_router_chain,
   "request": RunnablePassthrough()
} | delegation_branch | (lambda x: x['output'])

# --- ç¤ºä¾‹ç”¨æ³• ---
def main():
   if not llm:
       print("\nå›  LLM åˆå§‹åŒ–å¤±è´¥ï¼Œè·³è¿‡æ‰§è¡Œã€‚")
       return

   print("--- é¢„è®¢è¯·æ±‚ç¤ºä¾‹ ---")
   request_a = "å¸®æˆ‘é¢„è®¢é£å¾€ä¼¦æ•¦çš„æœºç¥¨ã€‚"
   result_a = coordinator_agent.invoke({"request": request_a})
   print(f"æœ€ç»ˆç»“æœ A: {result_a}")

   print("\n--- ä¿¡æ¯è¯·æ±‚ç¤ºä¾‹ ---")
   request_b = "æ„å¤§åˆ©çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ"
   result_b = coordinator_agent.invoke({"request": request_b})
   print(f"æœ€ç»ˆç»“æœ B: {result_b}")

   print("\n--- ä¸æ˜ç¡®è¯·æ±‚ç¤ºä¾‹ ---")
   request_c = "è®²è®²é‡å­ç‰©ç†ã€‚"
   result_c = coordinator_agent.invoke({"request": request_c})
   print(f"æœ€ç»ˆç»“æœ C: {result_c}")

if __name__ == "__main__":
   main()
```

å¦‚ä¸Šï¼ŒPython ä»£ç åˆ©ç”¨ LangChain å’Œ Google ç”Ÿæˆå¼ AIï¼ˆgemini-2.5-flashï¼‰æ„å»ºäº†ä¸€ä¸ªç®€å•æ™ºèƒ½ä½“ç³»ç»Ÿã€‚å®šä¹‰äº† `booking_handler`ã€`info_handler`ã€`unclear_handler` ä¸‰ä¸ªæ¨¡æ‹Ÿå­æ™ºèƒ½ä½“å¤„ç†å™¨ï¼Œåˆ†åˆ«å¤„ç†ä¸åŒç±»å‹è¯·æ±‚ã€‚

æ ¸å¿ƒç»„ä»¶ `coordinator_router_chain` é€šè¿‡ `ChatPromptTemplate` æŒ‡ç¤ºè¯­è¨€æ¨¡å‹å°†ç”¨æˆ·è¯·æ±‚åˆ†ç±»ä¸º `booker`ã€`info` æˆ– `unclear`ã€‚`RunnableBranch` æ ¹æ®åˆ†ç±»ç»“æœå°†åŸå§‹è¯·æ±‚å§”æ‰˜ç»™å¯¹åº”å¤„ç†å‡½æ•°ã€‚`coordinator_agent` ç»„åˆä¸Šè¿°ç»„ä»¶ï¼Œå…ˆè·¯ç”±è¯·æ±‚ï¼Œå†äº¤ç”±é€‰å®šå¤„ç†å™¨ï¼Œæœ€ç»ˆè¾“å‡ºå¤„ç†ç»“æœã€‚

`main` å‡½æ•°æ¼”ç¤ºäº†ä¸‰ç§è¯·æ±‚çš„å¤„ç†æµç¨‹ï¼Œå±•ç¤ºäº†ä¸åŒè¾“å…¥å¦‚ä½•è¢«è·¯ç”±å’Œå¤„ç†ã€‚ä»£ç åŒ…å«è¯­è¨€æ¨¡å‹åˆå§‹åŒ–é”™è¯¯å¤„ç†ï¼Œç»“æ„æ¨¡æ‹Ÿäº†å¤šæ™ºèƒ½ä½“æ¡†æ¶ä¸­åè°ƒè€…æ ¹æ®æ„å›¾å§”æ‰˜ä»»åŠ¡çš„æ¨¡å¼ã€‚

å®æˆ˜ä»£ç ç¤ºä¾‹ï¼ˆGoogle ADKï¼‰
------------------

Agent Development Kit (ADK) æ˜¯ç”¨äºå·¥ç¨‹åŒ–æ™ºèƒ½ä½“ç³»ç»Ÿçš„æ¡†æ¶ï¼Œæä¾›ç»“æ„åŒ–ç¯å¢ƒå®šä¹‰æ™ºèƒ½ä½“èƒ½åŠ›ä¸è¡Œä¸ºã€‚ä¸æ˜¾å¼è®¡ç®—å›¾æ¶æ„ä¸åŒï¼ŒADK è·¯ç”±é€šå¸¸é€šè¿‡å®šä¹‰ä¸€ç»„ä»£è¡¨æ™ºèƒ½ä½“åŠŸèƒ½çš„â€œå·¥å…·â€å®ç°ã€‚ç”¨æˆ·æŸ¥è¯¢ç”±åº•å±‚æ¨¡å‹åŒ¹é…åˆ°åˆé€‚å·¥å…·ï¼Œæ¡†æ¶å†…éƒ¨è‡ªåŠ¨å®Œæˆè·¯ç”±ã€‚

ä»¥ä¸‹ Python ä»£ç æ¼”ç¤ºäº†ä½¿ç”¨ Google ADK æ„å»ºçš„æ™ºèƒ½ä½“åº”ç”¨ã€‚è®¾ç½®äº†ä¸€ä¸ªâ€œåè°ƒè€…â€æ™ºèƒ½ä½“ï¼Œæ ¹æ®æŒ‡ä»¤å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°ä¸“ç”¨å­æ™ºèƒ½ä½“ï¼ˆâ€œBookerâ€è´Ÿè´£é¢„è®¢ï¼Œâ€œInfoâ€è´Ÿè´£ä¿¡æ¯ï¼‰ï¼Œå­æ™ºèƒ½ä½“é€šè¿‡å·¥å…·å‡½æ•°æ¨¡æ‹Ÿå¤„ç†è¯·æ±‚ï¼Œå±•ç¤ºäº†æ™ºèƒ½ä½“ç³»ç»Ÿä¸­çš„åŸºæœ¬å§”æ‰˜æ¨¡å¼ã€‚

ğŸ“„ Google ADK è·¯ç”±ç¤ºä¾‹ä»£ç 

```Python
# Copyright (c) 2025 Marco Fago
#
# æœ¬ä»£ç é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ä»“åº“ LICENSE æ–‡ä»¶ã€‚

import uuid
from typing import Dict, Any, Optional

from google.adk.agents import Agent
from google.adk.runners import InMemoryRunner
from google.adk.tools import FunctionTool
from google.genai import types
from google.adk.events import Event

# --- å®šä¹‰å·¥å…·å‡½æ•° ---
def booking_handler(request: str) -> str:
   """
   å¤„ç†æœºç¥¨å’Œé…’åº—é¢„è®¢è¯·æ±‚ã€‚
   Args:
       request: ç”¨æˆ·çš„é¢„è®¢è¯·æ±‚ã€‚
   Returns:
       é¢„è®¢å¤„ç†ç¡®è®¤ä¿¡æ¯ã€‚
   """
   print("-------------------------- é¢„è®¢å¤„ç†å™¨å·²è°ƒç”¨ ----------------------------")
   return f"å·²æ¨¡æ‹Ÿå¤„ç†é¢„è®¢è¯·æ±‚ï¼š'{request}'ã€‚"

def info_handler(request: str) -> str:
   """
   å¤„ç†ä¸€èˆ¬ä¿¡æ¯è¯·æ±‚ã€‚
   Args:
       request: ç”¨æˆ·é—®é¢˜ã€‚
   Returns:
       ä¿¡æ¯æ£€ç´¢å¤„ç†ç»“æœã€‚
   """
   print("-------------------------- ä¿¡æ¯å¤„ç†å™¨å·²è°ƒç”¨ ----------------------------")
   return f"ä¿¡æ¯è¯·æ±‚ï¼š'{request}'ã€‚ç»“æœï¼šæ¨¡æ‹Ÿä¿¡æ¯æ£€ç´¢ã€‚"

def unclear_handler(request: str) -> str:
   """å¤„ç†æ— æ³•å§”æ‰˜çš„è¯·æ±‚ã€‚"""
   return f"åè°ƒè€…æ— æ³•å§”æ‰˜è¯·æ±‚ï¼š'{request}'ã€‚è¯·è¡¥å……è¯´æ˜ã€‚"

# --- åˆ›å»ºå·¥å…· ---
booking_tool = FunctionTool(booking_handler)
info_tool = FunctionTool(info_handler)

# å®šä¹‰é…å¤‡å·¥å…·çš„ä¸“ç”¨å­æ™ºèƒ½ä½“
booking_agent = Agent(
   name="Booker",
   model="gemini-2.0-flash",
   description="ä¸“é—¨å¤„ç†æœºç¥¨å’Œé…’åº—é¢„è®¢è¯·æ±‚ï¼Œé€šè¿‡ booking tool å®ç°ã€‚",
   tools=[booking_tool]
)

info_agent = Agent(
   name="Info",
   model="gemini-2.0-flash",
   description="ä¸“é—¨æä¾›ä¸€èˆ¬ä¿¡æ¯å’Œç­”ç–‘ï¼Œé€šè¿‡ info tool å®ç°ã€‚",
   tools=[info_tool]
)

# å®šä¹‰çˆ¶æ™ºèƒ½ä½“ï¼ˆåè°ƒè€…ï¼‰ï¼ŒåŒ…å«å§”æ‰˜æŒ‡ä»¤
coordinator = Agent(
   name="Coordinator",
   model="gemini-2.0-flash",
   instruction=(
       "ä½ æ˜¯ä¸»åè°ƒè€…ï¼Œåªè´Ÿè´£åˆ†æç”¨æˆ·è¯·æ±‚å¹¶å§”æ‰˜ç»™åˆé€‚çš„ä¸“ç”¨æ™ºèƒ½ä½“ã€‚"
       "ä¸è¦ç›´æ¥å›ç­”ç”¨æˆ·ã€‚\n"
       "- ä»»ä½•æ¶‰åŠæœºç¥¨æˆ–é…’åº—é¢„è®¢çš„è¯·æ±‚ï¼Œå§”æ‰˜ç»™ 'Booker' æ™ºèƒ½ä½“ã€‚\n"
       "- å…¶ä»–ä¸€èˆ¬ä¿¡æ¯é—®é¢˜ï¼Œå§”æ‰˜ç»™ 'Info' æ™ºèƒ½ä½“ã€‚"
   ),
   description="è´Ÿè´£å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®ä¸“ç”¨æ™ºèƒ½ä½“çš„åè°ƒè€…ã€‚",
   sub_agents=[booking_agent, info_agent]
)

# --- æ‰§è¡Œé€»è¾‘ ---

async def run_coordinator(runner: InMemoryRunner, request: str):
   """ç”¨ç»™å®šè¯·æ±‚è¿è¡Œåè°ƒè€…æ™ºèƒ½ä½“å¹¶å§”æ‰˜ã€‚"""
   print(f"\n--- åè°ƒè€…è¿è¡Œè¯·æ±‚ï¼š'{request}' ---")
   final_result = ""
   try:
       user_id = "user_123"
       session_id = str(uuid.uuid4())
       await runner.session_service.create_session(
           app_name=runner.app_name, user_id=user_id, session_id=session_id
       )

       for event in runner.run(
           user_id=user_id,
           session_id=session_id,
           new_message=types.Content(
               role='user',
               parts=[types.Part(text=request)]
           ),
       ):
           if event.is_final_response() and event.content:
               if hasattr(event.content, 'text') and event.content.text:
                    final_result = event.content.text
               elif event.content.parts:
                   text_parts = [part.text for part in event.content.parts if part.text]
                   final_result = "".join(text_parts)
               break

       print(f"åè°ƒè€…æœ€ç»ˆå“åº”ï¼š{final_result}")
       return final_result
   except Exception as e:
       print(f"å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼š{e}")
       return f"å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ï¼š{e}"

async def main():
   """ä¸»å‡½æ•°ï¼Œè¿è¡Œ ADK ç¤ºä¾‹ã€‚"""
   print("--- Google ADK è·¯ç”±ç¤ºä¾‹ï¼ˆADK Auto-Flow é£æ ¼ï¼‰---")
   print("æ³¨æ„ï¼šéœ€å®‰è£…å¹¶è®¤è¯ Google ADKã€‚")

   runner = InMemoryRunner(coordinator)
   # ç¤ºä¾‹ç”¨æ³•
   result_a = await run_coordinator(runner, "å¸®æˆ‘é¢„è®¢å·´é»çš„é…’åº—ã€‚")
   print(f"æœ€ç»ˆè¾“å‡º A: {result_a}")
   result_b = await run_coordinator(runner, "ä¸–ç•Œæœ€é«˜çš„å±±å³°æ˜¯ä»€ä¹ˆï¼Ÿ")
   print(f"æœ€ç»ˆè¾“å‡º B: {result_b}")
   result_c = await run_coordinator(runner, "è¯´ä¸€ä¸ªéšæœºçš„äº‹å®ã€‚") # åº”å§”æ‰˜ç»™ Info
   print(f"æœ€ç»ˆè¾“å‡º C: {result_c}")
   result_d = await run_coordinator(runner, "æŸ¥æ‰¾ä¸‹ä¸ªæœˆé£å¾€ä¸œäº¬çš„èˆªç­ã€‚") # åº”å§”æ‰˜ç»™ Booker
   print(f"æœ€ç»ˆè¾“å‡º D: {result_d}")

if __name__ == "__main__":
   import nest_asyncio
   import asyncio
   nest_asyncio.apply()
   asyncio.run(main())
```

æœ¬è„šæœ¬åŒ…å«ä¸€ä¸ªä¸»åè°ƒè€…æ™ºèƒ½ä½“å’Œä¸¤ä¸ªä¸“ç”¨å­æ™ºèƒ½ä½“ï¼šBooker å’Œ Infoã€‚æ¯ä¸ªå­æ™ºèƒ½ä½“é…å¤‡ `FunctionTool`ï¼Œåˆ†åˆ«æ¨¡æ‹Ÿé¢„è®¢å’Œä¿¡æ¯æ£€ç´¢ã€‚`booking_handler` å¤„ç†æœºç¥¨å’Œé…’åº—é¢„è®¢ï¼Œ`info_handler` å¤„ç†ä¸€èˆ¬ä¿¡æ¯è¯·æ±‚ã€‚`unclear_handler` ç”¨äºæ— æ³•å§”æ‰˜çš„è¯·æ±‚ï¼ˆå½“å‰é€»è¾‘æœªæ˜¾å¼ä½¿ç”¨ï¼‰ã€‚

åè°ƒè€…æ™ºèƒ½ä½“çš„ä¸»è¦èŒè´£æ˜¯åˆ†æç”¨æˆ·æ¶ˆæ¯å¹¶è‡ªåŠ¨å§”æ‰˜ç»™ Booker æˆ– Infoï¼ŒADK çš„ Auto-Flow æœºåˆ¶ä¼šæ ¹æ® `sub_agents` è‡ªåŠ¨å®Œæˆå§”æ‰˜ã€‚`run_coordinator` å‡½æ•°è®¾ç½® `InMemoryRunner`ï¼Œåˆ›å»ºç”¨æˆ·å’Œä¼šè¯ IDï¼Œé€šè¿‡ `runner` å¤„ç†è¯·æ±‚å¹¶æå–æœ€ç»ˆå“åº”æ–‡æœ¬ã€‚

`main` å‡½æ•°æ¼”ç¤ºäº†ä¸åŒè¯·æ±‚çš„å¤„ç†æµç¨‹ï¼Œå±•ç¤ºäº†é¢„è®¢è¯·æ±‚å§”æ‰˜ç»™ Bookerï¼Œä¿¡æ¯è¯·æ±‚å§”æ‰˜ç»™ Infoã€‚

ä¸€å›¾é€Ÿè§ˆ
----

**æ˜¯ä»€ä¹ˆ**ï¼šæ™ºèƒ½ä½“ç³»ç»Ÿéœ€åº”å¯¹å¤šæ ·è¾“å…¥å’Œåœºæ™¯ï¼Œå•ä¸€çº¿æ€§æµç¨‹æ— æ³•æ ¹æ®ä¸Šä¸‹æ–‡åšå†³ç­–ã€‚ç¼ºä¹é€‰æ‹©åˆé€‚å·¥å…·æˆ–å­æµç¨‹çš„æœºåˆ¶ï¼Œç³»ç»Ÿå°†å˜å¾—åƒµåŒ–ï¼Œéš¾ä»¥åº”å¯¹çœŸå®ä¸–ç•Œçš„å¤æ‚è¯·æ±‚ã€‚

**ä¸ºä»€ä¹ˆ**ï¼šè·¯ç”±æ¨¡å¼é€šè¿‡å¼•å…¥æ¡ä»¶é€»è¾‘ï¼Œä¸ºæ™ºèƒ½ä½“æä¾›æ ‡å‡†åŒ–è§£å†³æ–¹æ¡ˆã€‚ç³»ç»Ÿå¯å…ˆåˆ†ææŸ¥è¯¢æ„å›¾ï¼Œå†åŠ¨æ€å°†æ§åˆ¶æµå¯¼å‘æœ€åˆé€‚çš„å·¥å…·ã€å‡½æ•°æˆ–å­æ™ºèƒ½ä½“ã€‚å†³ç­–å¯ç”± LLM æç¤ºã€è§„åˆ™ã€åµŒå…¥è¯­ä¹‰ç›¸ä¼¼åº¦ç­‰é©±åŠ¨ã€‚è·¯ç”±å°†é™æ€æ‰§è¡Œè·¯å¾„è½¬å˜ä¸ºçµæ´»ã€å…·å¤‡ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å·¥ä½œæµï¼Œèƒ½é€‰æ‹©æœ€ä½³åŠ¨ä½œã€‚

**ç»éªŒæ³•åˆ™**ï¼šå½“æ™ºèƒ½ä½“éœ€æ ¹æ®ç”¨æˆ·è¾“å…¥æˆ–å½“å‰çŠ¶æ€ï¼Œåœ¨å¤šä¸ªä¸åŒå·¥ä½œæµã€å·¥å…·æˆ–å­æ™ºèƒ½ä½“é—´åšé€‰æ‹©æ—¶ï¼Œåº”é‡‡ç”¨è·¯ç”±æ¨¡å¼ã€‚é€‚ç”¨äºéœ€å¯¹è¯·æ±‚è¿›è¡Œåˆ†æµæˆ–åˆ†ç±»çš„åº”ç”¨ï¼Œå¦‚å®¢æœæœºå™¨äººåŒºåˆ†é”€å”®ã€æŠ€æœ¯æ”¯æŒã€è´¦æˆ·ç®¡ç†ç­‰é—®é¢˜ã€‚

**è§†è§‰æ€»ç»“**ï¼š

![Image 1: å›¾ 1ï¼šè·¯ç”±æ¨¡å¼ï¼Œä½¿ç”¨ LLM ä½œä¸ºè·¯ç”±å™¨](./images/chapter02_fig1.jpg)

å›¾ 1ï¼šè·¯ç”±æ¨¡å¼ï¼Œä½¿ç”¨ LLM ä½œä¸ºè·¯ç”±å™¨

å…³é”®è¦ç‚¹
----

*   è·¯ç”±ä½¿æ™ºèƒ½ä½“å¯æ ¹æ®æ¡ä»¶åŠ¨æ€å†³ç­–ä¸‹ä¸€æ­¥æµç¨‹ã€‚
*   æ™ºèƒ½ä½“å¯å¤„ç†å¤šæ ·è¾“å…¥å¹¶è‡ªé€‚åº”è¡Œä¸ºï¼Œçªç ´çº¿æ€§æ‰§è¡Œé™åˆ¶ã€‚
*   è·¯ç”±é€»è¾‘å¯ç”¨ LLMã€è§„åˆ™ç³»ç»Ÿæˆ–åµŒå…¥ç›¸ä¼¼åº¦å®ç°ã€‚
*   LangGraphã€Google ADK ç­‰æ¡†æ¶æä¾›ç»“æ„åŒ–è·¯ç”±å®šä¹‰ä¸ç®¡ç†æ–¹å¼ï¼Œæ¶æ„é£æ ¼å„å¼‚ã€‚

æ€»ç»“
--

è·¯ç”±æ¨¡å¼æ˜¯æ„å»ºçœŸæ­£åŠ¨æ€ã€å“åº”å¼æ™ºèƒ½ä½“ç³»ç»Ÿçš„å…³é”®ä¸€æ­¥ã€‚é€šè¿‡å®ç°è·¯ç”±ï¼Œæ™ºèƒ½ä½“ä¸ä»…èƒ½è¶…è¶Šç®€å•çº¿æ€§æµç¨‹ï¼Œè¿˜èƒ½æ™ºèƒ½å†³ç­–å¦‚ä½•å¤„ç†ä¿¡æ¯ã€å“åº”ç”¨æˆ·è¾“å…¥ã€è°ƒç”¨å·¥å…·æˆ–å­æ™ºèƒ½ä½“ã€‚

è·¯ç”±å¯åº”ç”¨äºå®¢æœæœºå™¨äººã€å¤æ‚æ•°æ®å¤„ç†æµç¨‹ç­‰å¤šé¢†åŸŸã€‚åˆ†æè¾“å…¥å¹¶æœ‰æ¡ä»¶åœ°å¼•å¯¼å·¥ä½œæµï¼Œæ˜¯åº”å¯¹çœŸå®ä»»åŠ¡å¤šæ ·æ€§çš„åŸºç¡€ã€‚

LangChain å’Œ Google ADK çš„ä»£ç ç¤ºä¾‹å±•ç¤ºäº†ä¸¤ç§æœ‰æ•ˆçš„è·¯ç”±å®ç°æ–¹å¼ã€‚LangGraph çš„å›¾ç»“æ„é€‚åˆå¤æ‚å¤šæ­¥æµç¨‹çš„æ˜¾å¼çŠ¶æ€ä¸è½¬æ¢å®šä¹‰ï¼ŒGoogle ADK åˆ™ä¾§é‡èƒ½åŠ›ï¼ˆå·¥å…·ï¼‰å®šä¹‰ï¼Œç”±æ¡†æ¶è‡ªåŠ¨è·¯ç”±ï¼Œé€‚åˆåŠ¨ä½œæ˜ç¡®çš„æ™ºèƒ½ä½“ã€‚

æŒæ¡è·¯ç”±æ¨¡å¼ï¼Œæ˜¯æ‰“é€ èƒ½æ™ºèƒ½åº”å¯¹ä¸åŒåœºæ™¯ã€æ ¹æ®ä¸Šä¸‹æ–‡æä¾›å®šåˆ¶å“åº”æˆ–åŠ¨ä½œçš„æ™ºèƒ½ä½“åº”ç”¨çš„æ ¸å¿ƒèƒ½åŠ›ã€‚

å‚è€ƒèµ„æ–™
----

*   [LangGraph æ–‡æ¡£ - langchain.com](https://www.langchain.com/)
*   [Google Agent Developer Kit æ–‡æ¡£ - google.github.io](https://google.github.io/adk-docs/)
